<div class="mdl-cell mdl-cell--12-col"><a id=avr></a><h3>AVR Chiptuning</h3></div><div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-phone mdl-cell--4-col-tablet"><p><a href=/img/portfolio/avr_signin.png target=_blank><img class="ik-portfolio-thumb-img mdl-shadow--6dp" src=/img/portfolio/thumbs/avr_signin.png></a></p></div><div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-phone mdl-cell--4-col-tablet"><p><a href=/img/portfolio/avr_upload.png target=_blank><img class="ik-portfolio-thumb-img mdl-shadow--6dp" src=/img/portfolio/thumbs/avr_upload.png></a></p></div><div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-phone mdl-cell--4-col-tablet"><p><a href=/img/portfolio/avr_tuning_options.png target=_blank><img class="ik-portfolio-thumb-img mdl-shadow--6dp" src=/img/portfolio/thumbs/avr_tuning_options.png></a></p></div><div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-phone mdl-cell--4-col-tablet"><p><a href=/img/portfolio/avr_credits.png target=_blank><img class="ik-portfolio-thumb-img mdl-shadow--6dp" src=/img/portfolio/thumbs/avr_credits.png></a></p></div><div class="mdl-cell mdl-cell--12-col"><p>One of my favourite projects! Sadly, the client disappeared right in the middle of the service&rsquo;s frontend implementation, so the screenshots represent the work in progress.</p><p>But anyway here is the story.</p><p>David needed the car engines database to let the user select he want to tune. After research he found and bought the required DB. But because that DB was just a scraped raw data, there were a lot of corrupted data and of course it wasn&rsquo;t logically structured. So the primary goal was to model the data and create a complex CSV data normalizer</p><p>After that done, the next goal was to create an API. Here I decided to use my favourites: <code>Rack</code> wrapped in tiny <code>hanami-api</code>, <code>warden</code> for token authentication and <code>dry-rb</code> gems collection. That way we&rsquo;ve got a beautiful and testable code like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>module</span> Avr
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>module</span> Api
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>module</span> Endpoints
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>module</span> Employers
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SignIn</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Dry</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Monads</span><span style=color:#f92672>[</span><span style=color:#e6db74>:result</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Avr</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Api</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Endpoints</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Common</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Public</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Import</span><span style=color:#f92672>[</span><span style=color:#e6db74>&#39;avr.logging.logger&#39;</span>,
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>action</span>:     <span style=color:#e6db74>&#39;avr.actions.employers.sign_in&#39;</span>,
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>serializer</span>: <span style=color:#e6db74>&#39;avr.api.serializers.employee&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># Params: Hanami::Params</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call</span>(params)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> action<span style=color:#f92672>.</span>call(params<span style=color:#f92672>.</span>to_h)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>Success</span>(employee)
</span></span><span style=display:flex><span>              logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;Employee authenticated: </span><span style=color:#e6db74>#{</span>employee<span style=color:#f92672>.</span>inspect<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>              json_body(serializer<span style=color:#f92672>.</span>render(employee, <span style=color:#e6db74>view</span>: <span style=color:#e6db74>:sign_in</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>Failure</span>(<span style=color:#66d9ef>Dry</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Validation</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Result</span> <span style=color:#f92672>=&gt;</span> result) <span style=color:#75715e># match against validation: true</span>
</span></span><span style=display:flex><span>              api_validation_error(<span style=color:#e6db74>message</span>: <span style=color:#e6db74>&#39;Validation error&#39;</span>, <span style=color:#e6db74>errors</span>: result<span style=color:#f92672>.</span>errors<span style=color:#f92672>.</span>to_h)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>Failure</span>(result)
</span></span><span style=display:flex><span>              api_error(<span style=color:#e6db74>message</span>: result, <span style=color:#e6db74>error_type</span>: <span style=color:#e6db74>:sign_in</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>module</span> Avr
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>module</span> Actions
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>module</span> Employers
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SignIn</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Dry</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Monads</span><span style=color:#f92672>[</span><span style=color:#e6db74>:result</span>, <span style=color:#e6db74>:do</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Import</span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>&#39;avr.logging.logger&#39;</span>, <span style=color:#e6db74>&#39;avr.utils.api_tokens_generator&#39;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>employers</span>:  <span style=color:#e6db74>&#39;avr.repos.employers&#39;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>api_tokens</span>: <span style=color:#e6db74>&#39;avr.repos.employee_api_tokens&#39;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>contract</span>:   <span style=color:#e6db74>&#39;avr.api.contracts.employers.sign_in&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call</span>(params)
</span></span><span style=display:flex><span>          values   <span style=color:#f92672>=</span> <span style=color:#66d9ef>yield</span> validate(params)
</span></span><span style=display:flex><span>          employee <span style=color:#f92672>=</span> <span style=color:#66d9ef>yield</span> find_employee(values<span style=color:#f92672>[</span><span style=color:#e6db74>:email</span><span style=color:#f92672>]</span>)
</span></span><span style=display:flex><span>          employee <span style=color:#f92672>=</span> <span style=color:#66d9ef>yield</span> authenticate(employee, values<span style=color:#f92672>[</span><span style=color:#e6db74>:password</span><span style=color:#f92672>]</span>)
</span></span><span style=display:flex><span>          employee <span style=color:#f92672>=</span> <span style=color:#66d9ef>yield</span> generate_new_access_token(employee)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>Success</span>(employee)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># contracts return the result objects that keep both input values and errors.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate</span>(params)
</span></span><span style=display:flex><span>          contract<span style=color:#f92672>.</span>call(params)<span style=color:#f92672>.</span>to_monad
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_employee</span>(email)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (employee <span style=color:#f92672>=</span> employers<span style=color:#f92672>.</span>find_by_email(email))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Success</span>(employee)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Failure</span>(<span style=color:#e6db74>&#34;Can&#39;t find Employee&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>authenticate</span>(employee, password)
</span></span><span style=display:flex><span>          logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Authenticating&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>BCrypt</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Password</span><span style=color:#f92672>.</span>new(employee<span style=color:#f92672>.</span>password_digest) <span style=color:#f92672>==</span> password
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Password match!&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Success</span>(employee)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Password mismatch&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Failure</span>(<span style=color:#e6db74>&#34;Password mismatch&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_new_access_token</span>(employee)
</span></span><span style=display:flex><span>          logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Generating new access/reset token pair for employee: </span><span style=color:#e6db74>#{</span>employee<span style=color:#f92672>.</span>email<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          tokens_data <span style=color:#f92672>=</span> api_tokens_generator<span style=color:#f92672>.</span>generate
</span></span><span style=display:flex><span>          logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Creating new access/reset token pair for employee: </span><span style=color:#e6db74>#{</span>employee<span style=color:#f92672>.</span>email<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>          token <span style=color:#f92672>=</span> api_tokens<span style=color:#f92672>.</span>create(<span style=color:#e6db74>employee_id</span>: employee<span style=color:#f92672>.</span>id, <span style=color:#f92672>**</span>tokens_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>Failure</span>(<span style=color:#e6db74>&#34;Can&#39;t create access tokens&#34;</span>) <span style=color:#66d9ef>unless</span> token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          employee<span style=color:#f92672>.</span>current_api_token <span style=color:#f92672>=</span> token
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>Success</span>(employee)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Next step was to create frontend part. And that was the first time I choose Elm as a frontend language, having some awesome experience with it in my learning sandboxes. Everything went smooth until in the middle of frontend work my client stopped responding :(</p><p>Anyway, I&rsquo;d love to use Elm again someday, that was a joy to work with it!</p><p>Actually this project had my <strong>dream stack</strong>: parsers/normalizers, data modelling, APIs, lightweight stack and Elm for frontend. I&rsquo;d only add TailwindCSS in that list for completeness.</p><a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" href=https://avr-platform.herokuapp.com/ target=_blank>Visit</a></div>